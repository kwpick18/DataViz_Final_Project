---
title: "Final_Project"
author: "Kaden Pickering"
date: "3/21/2022"
output: html_document
---

```{r}
library(tidyverse) 

hockey_data <- read_csv("all_teams.csv") 
pittsburgh_penguins <- read_csv("Pittsburgh_data.csv") 
```

```{r}
all_situations <- hockey_data %>%
  filter(situation == "all") 

even_strength <- hockey_data %>%
  filter(situation == "5on5")

power_play <- hockey_data %>%
  filter(situation == "5on4")

short_handed <- hockey_data %>%
  filter(situation == "4on5")

other_situations <- hockey_data %>%
  filter(situation == "other") 
```

# Get the data set into a workable place that I can wrap my head around
```{r}
PP_all_situations <- pittsburgh_penguins %>%
  filter(situation == "all") 

PP_even_strength <- pittsburgh_penguins %>%
  filter(situation == "5on5")

PP_power_play <- pittsburgh_penguins %>%
  filter(situation == "5on4")

PP_short_handed <- pittsburgh_penguins %>%
  filter(situation == "4on5")

PP_other_situations <- pittsburgh_penguins %>%
  filter(situation == "other") 
```

# Start even smaller to get some perspective
```{r}
Pitt_2017 <- pittsburgh_penguins %>%
  filter(season == "2017") %>%
  mutate(propShotsThrough = shotsOnGoalFor / shotAttemptsFor) 
   #rename(goalsFor = goalsFor)
```


```{r}
PP_all_situations_small <- Pitt_2017 %>%
  filter(situation == "all") 

PP_even_strength_small <- Pitt_2017 %>%
  filter(situation == "5on5")

PP_power_play_small <- Pitt_2017 %>%
  filter(situation == "5on4")

PP_short_handed_small <- Pitt_2017 %>%
  filter(situation == "4on5")

PP_other_situations_small <- Pitt_2017 %>%
  filter(situation == "other")
```
 
# The more shots, the better chance of scoring...right? Let's see if that theory checks out in all situations. 

```{r}
shotsThrough_sub <- Pitt_2017 %>% 
  filter(opposingTeam == "WSH")

 ggplot(shotsThrough_sub, aes(x = propShotsThrough, y = goalsFor)) +
  geom_point()
```

```{r}
PPtableData <- Pitt_2017 %>%
  select(gameId, situation, shotsOnGoalFor, missedShotsFor, blockedShotAttemptsFor, shotAttemptsFor, goalsFor, propShotsThrough)
```


```{r}
library(shiny)

ui <- fluidPage(
  
  tabsetPanel(
    tabPanel("More Shots = More Goals?", fluid = TRUE, 
  titlePanel("Do More Successful Shot Attempts Lead to More Goals?"), 
  
  sidebarLayout(sidebarPanel(
    selectInput("opponentchoice",
    label = "Choose an Opponent", choices = levels(factor(Pitt_2017$opposingTeam)),
    selected = "STL")),
                mainPanel(plotOutput("scatterplot"),
                          tableOutput("goaltable"))
                )
  
),
  tabPanel("IceTime", fluid = TRUE, 
           titlePanel("More Icetime = More Goals?"), 
           
           sidebarLayout(sidebarPanel(
             selectInput("opponentchoice", 
            label = "Choose a Team", choices= levels(factor(Pitt_2017$opposingTeam)), selected = "NYR")), 
            mainPanel = (plotOutput("scatter"))
           ))))

server <- function(input, output, session) {
  
  shotsThrough_sub <- reactive({
    Pitt_2017 %>% filter(opposingTeam == input$opponentchoice)
  })
  
  iceTime_sub <- reactive({
    Pitt_2017 %>% filter(opposingTeam == input$opponentchoice)
  })
  
  scatter_plot <- reactive({ 
    ggplot(shotsThrough_sub(), aes(x = goalsFor, y = propShotsThrough)) +
  geom_point() + 
      geom_smooth(method = lm) +
    theme_classic() + 
    facet_wrap(~ situation) +
      labs(x = "Goals Scored", y = "Proportion of Shot Attempts On Net")
  })
  
  scatter_plot2 <- reactive({
    ggplot(iceTime_sub(), aes(x = goalsFor, y = iceTime)) +
      geom_point()
  })
  
  output$scatterplot <- renderPlot({
    scatter_plot()
  })
  
  output$goaltable <- renderTable({
    goalFilter <- subset(PPtableData, Pitt_2017$opposingTeam == input$opponentchoice)
      
  })
}

shinyApp(ui, server)
```

#Extra code for shiny 

 small_shotsThrough_sub <- reactive({
    shotsThrough_sub %>% filter(opposingTeam == input$gamechoice)
  })
  
  scatter_plot <- reactive({
    ggplot(small_shotsThrough_sub(), aes(x = .data[[input$varchoice]])) +
      geom_point()
  })
  
  output$scatterplot <- renderPlot({
    scatter_plot()
  })
  
  
  
  #radioButtons("varchoice", label = "Choose a Category",
                 #choices = var_choices),
                 
                 # var_choices <- names(PP_shots)[2:4]
                 
                 
  Tomorrow, 3/30, begin making second part of app with radio buttons to choose all situations of shots to see it on a wider scale for the 2017 pittsburgh penguins. Also, ask how to create a reactive table for each. 